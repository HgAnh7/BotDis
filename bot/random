import random
import discord
from pathlib import Path
from discord.ext import commands

# Danh sÃ¡ch cÃ¡c kÃªnh Ä‘Æ°á»£c phÃ©p sá»­ dá»¥ng lá»‡nh
ALLOWED_CHANNELS = [
    1375707188252901376,  # Thay báº±ng ID cá»§a kÃªnh thá»±c táº¿
    1375707367051886654,
]

# KÃªnh gá»­i thÃ´ng bÃ¡o lá»—i
ERROR_CHANNEL_ID = 1377693583741812867

# HÃ m load danh sÃ¡ch URL tá»« file
def load_images(file_path: Path):
    try:
        with file_path.open("r", encoding="utf-8") as file:
            images = [line.strip() for line in file if line.strip()]
        return images
    except Exception as e:
        print(f"[Load Images] Lá»—i khi Ä‘á»c file {file_path}: {e}")
        return []

# Cache danh sÃ¡ch URL khi bot khá»Ÿi Ä‘á»™ng
COSPLAY_FILE_PATH = Path("bot/url/cosplay")
COSPLAY_IMAGES = load_images(COSPLAY_FILE_PATH)

GIRLSEXY_FILE_PATH = Path("bot/url/girlsexy")
GIRLSEXY_IMAGES = load_images(GIRLSEXY_FILE_PATH)

def register_cosplay(bot: commands.Bot):
    @bot.tree.command(name="cosplay", description="Gá»­i áº£nh cosplay ngáº«u nhiÃªn (only: ğŸ”â”Šnsfw)")
    async def cosplay(interaction: discord.Interaction):
        if interaction.channel_id not in ALLOWED_CHANNELS:
            await interaction.response.send_message(
                "âŒ Lá»‡nh nÃ y chá»‰ cÃ³ thá»ƒ sá»­ dá»¥ng trong cÃ¡c kÃªnh Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh!",
                ephemeral=True
            )
            return

        if not COSPLAY_IMAGES:
            error_message = "Danh sÃ¡ch áº£nh chÆ°a Ä‘Æ°á»£c táº£i hoáº·c trá»‘ng."
            error_channel = bot.get_channel(ERROR_CHANNEL_ID)
            if error_channel:
                await error_channel.send(f"âŒ [Cosplay] {error_message}")
            await interaction.response.send_message("âŒ Lá»—i: Danh sÃ¡ch áº£nh khÃ´ng tá»“n táº¡i.", ephemeral=True)
            return

        try:
            selected_image = random.choice(COSPLAY_IMAGES)
            embed = discord.Embed(title="Cosplay Ngáº«u NhiÃªn")
            embed.set_image(url=selected_image)
            await interaction.response.send_message(embed=embed)
        except Exception as e:
            error_channel = bot.get_channel(ERROR_CHANNEL_ID)
            if error_channel:
                await error_channel.send(f"âŒ [Cosplay] Lá»—i: {e}")
            await interaction.response.send_message(
                "âŒ ÄÃ£ cÃ³ lá»—i xáº£y ra. Vui lÃ²ng thá»­ láº¡i sau.",
                ephemeral=True
            )

def register_girlsexy(bot: commands.Bot):
    @bot.tree.command(name="girlsexy", description="Gá»­i áº£nh gÃ¡i sexy ngáº«u nhiÃªn (only: ğŸ”â”Šnsfw)")
    async def girlsexy(interaction: discord.Interaction):
        if interaction.channel_id not in ALLOWED_CHANNELS:
            await interaction.response.send_message(
                "âŒ Lá»‡nh nÃ y chá»‰ cÃ³ thá»ƒ sá»­ dá»¥ng trong cÃ¡c kÃªnh Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh!",
                ephemeral=True
            )
            return

        if not GIRLSEXY_IMAGES:
            error_message = "Danh sÃ¡ch áº£nh chÆ°a Ä‘Æ°á»£c táº£i hoáº·c trá»‘ng."
            error_channel = bot.get_channel(ERROR_CHANNEL_ID)
            if error_channel:
                await error_channel.send(f"âŒ [Manga] {error_message}")
            await interaction.response.send_message("âŒ Lá»—i: Danh sÃ¡ch áº£nh khÃ´ng tá»“n táº¡i.", ephemeral=True)
            return

        try:
            selected_image = random.choice(GIRLSEXY_IMAGES)
            embed = discord.Embed(title="GÃ¡i Sexy Ngáº«u NhiÃªn")
            embed.set_image(url=selected_image)
            await interaction.response.send_message(embed=embed)
        except Exception as e:
            error_channel = bot.get_channel(ERROR_CHANNEL_ID)
            if error_channel:
                await error_channel.send(f"âŒ [Girlsexy] Lá»—i: {e}")
            await interaction.response.send_message(
                "âŒ ÄÃ£ cÃ³ lá»—i xáº£y ra. Vui lÃ²ng thá»­ láº¡i sau.",
                ephemeral=True
            )