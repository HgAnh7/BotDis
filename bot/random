import io
import random
import discord
import requests
from discord.ext import commands

ALLOWED_CHANNELS = [
    1375707188252901376,  # Thay bằng ID kênh thực tế
    1375707367051886654,  # Có thể thêm nhiều kênh
]

def register_cosplay(bot: commands.Bot):
    @bot.tree.command(name="cosplay", description="Gửi ảnh cosplay ngẫu nhiên (only: 🔞┊nsfw)")
    async def cosplay(interaction: discord.Interaction):
        if interaction.channel_id not in ALLOWED_CHANNELS:
            await interaction.response.send_message(
                "❌ Lệnh này chỉ có thể sử dụng trong các kênh được chỉ định!",
                ephemeral=True
            )
            return

        try:
            file_path = "bot/url/cosplay"
            with open(file_path, "r", encoding="utf-8") as file:
                image_urls = [line.strip() for line in file if line.strip()]
            
            selected_image = random.choice(image_urls)
            await interaction.response.send_message(selected_image)

        except Exception as e:
            await interaction.response.send_message(
                f"❌ Lỗi: {e}",
                ephemeral=True
            )
